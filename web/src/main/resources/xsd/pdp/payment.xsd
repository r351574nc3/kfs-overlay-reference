<?xml version="1.0" encoding="UTF-8"?>
<!--
 Copyright 2007-2008 The Kuali Foundation
 
 Licensed under the Educational Community License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
 
 http://www.opensource.org/licenses/ecl2.php
 
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
<xsd:schema elementFormDefault="qualified"
    targetNamespace="http://www.kuali.org/kfs/pdp/payment"
    xmlns:kfs="http://www.kuali.org/kfs/sys/types"
    xmlns:dd="http://www.kuali.org/kfs/sys/ddTypes"
    xmlns="http://www.kuali.org/kfs/pdp/payment" xmlns:xsd="http://www.w3.org/2001/XMLSchema">

    <xsd:import namespace="http://www.kuali.org/kfs/sys/types" schemaLocation="@externalizable.static.content.url@/xsd/sys/types.xsd" />
    <xsd:import namespace="http://www.kuali.org/kfs/sys/ddTypes" schemaLocation="@externalizable.static.content.url@/xsd/sys/ddTypes.xsd" />
        
    <!-- simple data types -->
    <xsd:simpleType name="versionType">
        <xsd:restriction base="xsd:string">
            <xsd:pattern value="1.0"/>
        </xsd:restriction>
    </xsd:simpleType>
    
    <!-- definition of simple type elements -->
    <xsd:element name="chart" type="${xsd:normalizedString,dd:PaymentFileLoad.chart}"/>
    <xsd:element name="unit" type="${xsd:normalizedString,dd:PaymentFileLoad.unit}"/>
    <xsd:element name="sub_unit" type="${xsd:normalizedString,dd:PaymentFileLoad.subUnit}"/>
    <xsd:element name="creation_date" type="${xsd:normalizedString,dd:PaymentFileLoad.creationDate}"/>
    <xsd:element name="source_doc_nbr" type="${xsd:normalizedString,dd:PaymentDetail.custPaymentDocNbr}"/>
    <xsd:element name="invoice_nbr" type="${xsd:normalizedString,dd:PaymentDetail.invoiceNbr}"/>
    <xsd:element name="po_nbr" type="${xsd:normalizedString,dd:PaymentDetail.purchaseOrderNbr}"/>
    <xsd:element name="req_nbr" type="${xsd:normalizedString,dd:PaymentDetail.requisitionNbr}"/>
    <xsd:element name="org_doc_nbr" type="${xsd:normalizedString,dd:PaymentDetail.organizationDocNbr}"/>
    <xsd:element name="payee_name" type="${xsd:normalizedString,dd:PaymentGroup.payeeName}"/>
    <xsd:element name="payee_own_cd" type="${xsd:normalizedString,dd:PaymentGroup.payeeOwnerCd}"/>
    <xsd:element name="customer_institution_identifier" type="${xsd:normalizedString,dd:PaymentGroup.customerInstitutionNumber}"/>
    <xsd:element name="address1" type="${xsd:normalizedString,dd:PaymentGroup.line1Address}"/>
    <xsd:element name="address2" type="${xsd:normalizedString,dd:PaymentGroup.line2Address}"/>
    <xsd:element name="address3" type="${xsd:normalizedString,dd:PaymentGroup.line3Address}"/>
    <xsd:element name="address4" type="${xsd:normalizedString,dd:PaymentGroup.line4Address}"/>
    <xsd:element name="city" type="${xsd:normalizedString,dd:PaymentGroup.city}"/>
    <xsd:element name="state" type="${xsd:normalizedString,dd:PaymentGroup.state}"/>
    <xsd:element name="zip" type="${xsd:normalizedString,dd:PaymentGroup.zipCd}"/>
    <xsd:element name="country" type="${xsd:normalizedString,dd:PaymentGroup.country}"/>
    <xsd:element name="campus_address_ind" type="${xsd:normalizedString,dd:PaymentGroup.campusAddress}"/>
    <xsd:element name="payment_date" type="${xsd:date,dd:PaymentGroup.paymentDate}"/>
    <xsd:element name="invoice_date" type="${xsd:normalizedString,dd:PaymentDetail.invoiceDate}"/>
    <xsd:element name="attachment_ind" type="${xsd:normalizedString,dd:PaymentGroup.pymtAttachment}"/>
    <xsd:element name="special_handling_ind" type="${xsd:normalizedString,dd:PaymentGroup.pymtSpecialHandling}"/>
    <xsd:element name="taxable_ind" type="${xsd:normalizedString,dd:PaymentGroup.taxablePayment}"/>
    <xsd:element name="orig_invoice_amt" type="${xsd:decimal,dd:PaymentDetail.origInvoiceAmount}"/>
    <xsd:element name="net_payment_amt" type="${xsd:decimal,dd:PaymentDetail.netPaymentAmount}"/>
    <xsd:element name="invoice_tot_discount_amt" type="${xsd:decimal,dd:PaymentDetail.invTotDiscountAmount}"/>
    <xsd:element name="invoice_tot_ship_amt" type="${xsd:decimal,dd:PaymentDetail.invTotShipAmount}"/>
    <xsd:element name="invoice_tot_other_debits" type="${xsd:decimal,dd:PaymentDetail.invTotOtherDebitAmount}"/>
    <xsd:element name="invoice_tot_other_credits" type="${xsd:decimal,dd:PaymentDetail.invTotOtherCreditAmount}"/>
    <xsd:element name="nra_ind" type="${xsd:normalizedString,dd:PaymentGroup.nraPayment}"/>
    <xsd:element name="combine_group_ind" type="${xsd:normalizedString,dd:PaymentGroup.combineGroups}"/>
    <xsd:element name="coa_cd" type="${xsd:normalizedString,dd:PaymentAccountDetail.finChartCode}"/>
    <xsd:element name="account_nbr" type="${xsd:normalizedString,dd:PaymentAccountDetail.accountNbr}"/>
    <xsd:element name="sub_account_nbr"  type="${xsd:normalizedString,dd:PaymentAccountDetail.subAccountNbr}"/>
    <xsd:element name="object_cd" type="${xsd:normalizedString,dd:PaymentAccountDetail.finObjectCode}"/>
    <xsd:element name="sub_object_cd" type="${xsd:normalizedString,dd:PaymentAccountDetail.finSubObjectCode}"/>
    <xsd:element name="org_ref_id" type="${xsd:normalizedString,dd:PaymentAccountDetail.orgReferenceId}"/>
    <xsd:element name="project_cd" type="${xsd:normalizedString,dd:PaymentAccountDetail.projectCode}"/>
    <xsd:element name="amount" type="${xsd:normalizedString,dd:PaymentAccountDetail.accountNetAmount}"/>
    <xsd:element name="payment_text" type="${xsd:normalizedString,dd:PaymentNoteText.customerNoteText}"/>
    <xsd:element name="detail_count" type="${xsd:integer,dd:PaymentFileLoad.paymentCount}"/>
    <xsd:element name="detail_tot_amt" type="${xsd:decimal,dd:PaymentFileLoad.paymentTotalAmount}"/>
    <xsd:element name="bank_code" type="${xsd:normalizedString,dd:Bank.bankCode}"/> 
    <xsd:element name="fs_origin_cd" type="${xsd:normalizedString,dd:PaymentDetail.financialSystemOriginCode}"/> 
    <xsd:element name="fdoc_typ_cd"  type="${xsd:normalizedString,dd:PaymentDetail.financialDocumentTypeCode}"/> 
    
    <!-- definition of attributes -->
    
    <!-- definition of complex type elements -->
    <xsd:element name="pdp_file">
        <xsd:complexType>
            <xsd:sequence>
                <xsd:element ref="header"/>
                <xsd:element maxOccurs="unbounded" minOccurs="1" ref="group"/>
                <xsd:element ref="trailer"/>
            </xsd:sequence>
            <xsd:attribute name="version" type="versionType" use="required"/>
        </xsd:complexType>
    </xsd:element>
    
    <xsd:element name="accounting">
        <xsd:complexType>
            <xsd:sequence>
                <xsd:element maxOccurs="1" minOccurs="0" ref="coa_cd"/>
                <xsd:element maxOccurs="1" minOccurs="1" ref="account_nbr"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="sub_account_nbr"/>
                <xsd:element ref="object_cd"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="sub_object_cd"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="org_ref_id"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="project_cd"/>
                <xsd:element ref="amount"/>
            </xsd:sequence>
        </xsd:complexType>
    </xsd:element>
    
    <xsd:element name="header">
        <xsd:complexType>
            <xsd:sequence>
                <xsd:element ref="chart"/>
                <xsd:element ref="unit"/>
                <xsd:element ref="sub_unit"/>
                <xsd:element ref="creation_date"/>
            </xsd:sequence>
        </xsd:complexType>
    </xsd:element>
    
    <xsd:element name="trailer">
        <xsd:complexType>
            <xsd:sequence>
                <xsd:element ref="detail_count"/>
                <xsd:element ref="detail_tot_amt"/>
            </xsd:sequence>
        </xsd:complexType>
    </xsd:element>
    
    <xsd:element name="group">
        <xsd:complexType>
            <xsd:sequence>
                <xsd:element ref="payee_name"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="payee_id"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="payee_own_cd"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="customer_institution_identifier"/>
                <xsd:element ref="address1"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="address2"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="address3"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="address4"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="city"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="state"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="zip"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="country"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="campus_address_ind"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="payment_date"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="attachment_ind"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="special_handling_ind"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="taxable_ind"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="nra_ind"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="combine_group_ind"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="bank_code"/>
                <!--  Default check stub holds 27 note lines.  There is a line printed for each detail
                      so the number of detail items on a check needs to be subtracted from the 
                      total allowed note lines.  This can't be enforced in the schema so it is possible
                      to provide too many note lines in some cases.  This rule will be enforced in
                      code. 
                      
                      Because of this, the maximum number of detail segments is 27 (assuming they 
                      have no notes).
                      
                      If your check stub holds more or less than 27 note lines, you need to change this,
                      the maximum number of detail segments in this file and the setting MAX_NOTE_LINES
                      in the application settings file.
                      -->
                <xsd:element maxOccurs="27" minOccurs="1" ref="detail"/>
            </xsd:sequence>
        </xsd:complexType>
    </xsd:element>
    
    <xsd:element name="detail">
        <xsd:complexType>
            <xsd:sequence>
                <xsd:element ref="source_doc_nbr"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="invoice_nbr"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="po_nbr"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="req_nbr"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="org_doc_nbr"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="invoice_date"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="orig_invoice_amt"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="net_payment_amt"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="invoice_tot_discount_amt"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="invoice_tot_ship_amt"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="invoice_tot_other_debits"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="invoice_tot_other_credits"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="fs_origin_cd"/>
                <xsd:element maxOccurs="1" minOccurs="0" ref="fdoc_typ_cd"/>
                <xsd:element maxOccurs="unbounded" minOccurs="1" ref="accounting"/>
                <!--  Default check stub holds 27 note lines.  There is a line printed for each detail
                      so the number of detail items on a check needs to be subtracted from the 
                      total allowed note lines.  This can't be enforced in the schema so it is possible
                      to provide too many note lines in some cases.  This rule will be enforced in
                      code. 
                      
                      Because of this, the maximum note lines a detail can have is 26 (assuming there
                      is only one detail in the payment group).
                      
                      If your check stub holds more or less than 27 note lines, you need to change this,
                      the maximum number of detail segments in this file and the setting MAX_NOTE_LINES
                      in the application settings file.
                      -->
                <xsd:element maxOccurs="26" minOccurs="0" ref="payment_text"/>
            </xsd:sequence>
        </xsd:complexType>
    </xsd:element>
    
    <xsd:element name="payee_id">
        <xsd:complexType>
            <xsd:simpleContent>
                <xsd:extension base="kfs:oneToTwentyFiveCharType">
                    <xsd:attribute name="id_type" type="kfs:oneAlphaType" use="required"/>
                </xsd:extension>
            </xsd:simpleContent>
        </xsd:complexType>
    </xsd:element>
    
</xsd:schema>
